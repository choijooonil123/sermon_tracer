<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>설교추적시스템 001</title>
  <style>
    .unitBox.level1 {
      border-color: #007acc;
      background: #e6f2ff;
    }
    .unitBox.level2 {
      border-color: #33aa33;
      background: #e8ffe8;
      margin-left: 20px;
    }
    .unitBox.level3 {
      border-color: #e69500;
      background: #fff3e6;
      margin-left: 40px;
    }
    .highlight {
      background: yellow;
      font-weight: bold;
    }
  </style>
</head>
<body>

<textarea id="sermonInput"></textarea>
<div id="previewBox"></div>

<script>
let selectedIndex = -1;
let currentUnits = [];

function parseSermonByPattern(text) {
  const lines = text.split(/\n+/);
  const units = [];
  lines.forEach(line => {
    line = line.trim();
    if (/^\d+\.\s+/.test(line)) {
      units.push({ level: 1, content: line });
    } else if (/^\d+\)\s+/.test(line)) {
      units.push({ level: 2, content: line });
    } else if (/^\(\d+\)\s+/.test(line)) {
      units.push({ level: 3, content: line });
    } else if (line.length > 0) {
      units.push({ level: 3, content: line });
    }
  });
  return units;
}

function renderPreview(units) {
  const preview = document.getElementById("previewBox");
  preview.innerHTML = units.map((u, i) => {
    const isSelected = i === selectedIndex;
    const boxClass = `unitBox level${u.level}` + (isSelected ? ' selected' : '');
    const content = isSelected ? `<span class='highlight'>${u.content}</span>` : u.content;
    return `<div class="${boxClass}" data-index="${i}" id="unit-${i}">${content}</div>`;
  }).join("\n");

  // 현재 선택된 문장 자동 스크롤
  if (selectedIndex >= 0) {
    const el = document.getElementById(`unit-${selectedIndex}`);
    if (el) el.scrollIntoView({ behavior: "smooth", block: "center" });
  }
}

document.getElementById("sermonInput").addEventListener("input", () => {
  const text = document.getElementById("sermonInput").value;
  currentUnits = parseSermonByPattern(text);
  selectedIndex = 0; // 입력 시 처음부터 보기
  renderPreview(currentUnits);
});

document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft" || e.key === "PageUp" || e.key === "ArrowUp") {
    selectedIndex = Math.max(0, selectedIndex - 1);
  } else if (e.key === "ArrowRight" || e.key === "PageDown" || e.key === "ArrowDown") {
    selectedIndex = Math.min(currentUnits.length - 1, selectedIndex + 1);
  } else {
    return;
  }
  renderPreview(currentUnits);
});
</script>

</body>
</html>
